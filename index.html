<!DOCTYPE html>




<html class="theme-next gemini" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="imlhcn,imlh,lh,spring-cloud,spring-boot,micro-service" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="生命有限，能量守恒码农生涯，重在过程">
<meta property="og:type" content="website">
<meta property="og:title" content="木鱼&#39;s Blog">
<meta property="og:url" content="http://imlh.cn/index.html">
<meta property="og:site_name" content="木鱼&#39;s Blog">
<meta property="og:description" content="生命有限，能量守恒码农生涯，重在过程">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="木鱼&#39;s Blog">
<meta name="twitter:description" content="生命有限，能量守恒码农生涯，重在过程">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://imlh.cn/"/>





  <title>木鱼's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">木鱼's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">策码浆糊，留点笔迹</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201709/git/git-flow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201709/git/git-flow/" itemprop="url">git-flow</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-13T11:28:29+08:00">
                2017-09-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201709/collection/java资料/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201709/collection/java资料/" itemprop="url">java资料</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-03T16:12:45+08:00">
                2017-09-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h3><p><a href="https://github.com/iluwatar/java-design-patterns" target="_blank" rel="external">https://github.com/iluwatar/java-design-patterns</a></p>
<h3 id="RxJava"><a href="#RxJava" class="headerlink" title="RxJava"></a>RxJava</h3><p><a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">https://github.com/ReactiveX/RxJava</a></p>
<h3 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h3><p><a href="https://github.com/mapstruct/mapstruct" target="_blank" rel="external">https://github.com/mapstruct/mapstruct</a><br><a href="https://github.com/modelmapper/modelmapper" target="_blank" rel="external">https://github.com/modelmapper/modelmapper</a></p>
<h3 id="http"><a href="#http" class="headerlink" title="http"></a>http</h3><p><a href="http://square.github.io/retrofit/" target="_blank" rel="external">http://square.github.io/retrofit/</a><br><a href="http://square.github.io/okhttp/" target="_blank" rel="external">http://square.github.io/okhttp/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201709/spring-boot/spring-boot-rest-api-error-handling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201709/spring-boot/spring-boot-rest-api-error-handling/" itemprop="url">spring-boot-rest-api-error-handling</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-01T13:59:31+08:00">
                2017-09-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="应该说是springMvc的"><a href="#应该说是springMvc的" class="headerlink" title="应该说是springMvc的"></a>应该说是springMvc的</h1><p><a href="https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc" target="_blank" rel="external">https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc</a><br><a href="https://www.toptal.com/java/spring-boot-rest-api-error-handling" target="_blank" rel="external">https://www.toptal.com/java/spring-boot-rest-api-error-handling</a></p>
<p><img src="http://blog.imlh.cn/img/201792/spring-boot-rest-api-error-handling.png" alt="spring-boot-rest-api-error-handling"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201708/tools/IDEA-mac-下面debug卡一下的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201708/tools/IDEA-mac-下面debug卡一下的问题/" itemprop="url">IDEA mac 下面debug卡一下的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-30T09:29:38+08:00">
                2017-08-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先用命令看看hostname<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hostname</div><div class="line">hmp.local</div><div class="line"></div><div class="line">vim /etc/hosts</div></pre></td></tr></table></figure></p>
<p>在hosts文件的localhost加上 hostname 如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 127.0.0.1 localhost</span></div><div class="line">127.0.0.1 localhost hmp.local</div></pre></td></tr></table></figure></p>
<p>说是jdk8 的bug<br><a href="https://bugs.openjdk.java.net/browse/JDK-8044306" target="_blank" rel="external">https://bugs.openjdk.java.net/browse/JDK-8044306</a><br><a href="https://stackoverflow.com/questions/1881546/inetaddress-getlocalhost-throws-unknownhostexception" target="_blank" rel="external">https://stackoverflow.com/questions/1881546/inetaddress-getlocalhost-throws-unknownhostexception</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201708/spring-boot/SpringMvc-中文编码问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201708/spring-boot/SpringMvc-中文编码问题/" itemprop="url">SpringMvc GET 中文编码问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-29T21:29:39+08:00">
                2017-08-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="不用utf8-就是坑"><a href="#不用utf8-就是坑" class="headerlink" title="不用utf8 就是坑"></a>不用utf8 就是坑</h1><p>最近对接某 .net系统的接口，对方的一个接口用get传中文回调到我们系统，里面的url参数用gb2312编码 类似<br>curl <a href="http://localhost:8080/req\" target="_blank" rel="external">http://localhost:8080/req\</a><br>?params=100AbC%E4%B8%AD%E6%96%87\<br>&amp;params=100AbC%3F%3F\<br>&amp;params=100AbC%D6%D0%CE%C4\<br>&amp;params=100AbC%D6%D0%CE%C4</p>
<p>参数用了4种编码：”UTF-8”, “ISO-8859-1”, “GBK”, “gb2312”<br>方向走错于是进行了各种尝试…..<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GetMapping</span>(<span class="string">"/bytes"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bytes</span><span class="params">(<span class="keyword">byte</span>[] params)</span></span>&#123;&#125;<span class="comment">//此路不通</span></div><div class="line"></div><div class="line"><span class="meta">@GetMapping</span>(<span class="string">"/req"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">req</span><span class="params">(HttpServletRequest req)</span> </span>&#123;</div><div class="line">    String [] params=req.getParameters(<span class="string">"param"</span>);<span class="comment">// 此路不通，一开始只想到这里，然后绕远了</span></div><div class="line">    <span class="comment">// 尝试各种转换浪费了半天生命...............</span></div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 结果 ----------------------------------------</span></div><div class="line"><span class="comment">// 发现SpringMvc自动组装参数的编码是根据 URIEncoding这个值全局的，不可能为你一个接口改了全局配置</span></div><div class="line"><span class="comment">// 那么只能绕过框架自动处理的,估计是今天没睡好，上一步差一点点了居然没想到</span></div><div class="line"><span class="meta">@GetMapping</span>(<span class="string">"/req"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">req</span><span class="params">(HttpServletRequest req)</span> </span>&#123;</div><div class="line">    String query = req.getQueryString();<span class="comment">// 用这个手动来即可</span></div><div class="line">    URLDecoder.decode(query,<span class="string">"gb2312"</span>);<span class="comment">//</span></div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201708/spring-cloud/简洁之美-用groovy玩sc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201708/spring-cloud/简洁之美-用groovy玩sc/" itemprop="url">简洁之美,用groovy玩sc</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-29T20:14:39+08:00">
                2017-08-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="人生短暂-我用python"><a href="#人生短暂-我用python" class="headerlink" title="人生短暂,我用python"></a>人生短暂,我用python</h4><p>真的太过短暂，在了解python之前，已经玩了几年java,不过还好有groovy.<br>如果spring-boot比作自动波，那么用上groovy已经算是无人驾驶了.</p>
<h4 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h4><p><a href="http://cloud.spring.io/spring-cloud-static/Camden.SR7/#_spring_boot_cloud_cli" target="_blank" rel="external">spring-cloud</a></p>
<h4 id="下载sdkman-并且装两个-cli"><a href="#下载sdkman-并且装两个-cli" class="headerlink" title="下载sdkman,并且装两个 cli"></a>下载sdkman,并且装两个 cli</h4><p><a href="http://sdkman.io/install.html" target="_blank" rel="external">sdk-man</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> SDKMAN_DIR=<span class="string">"/Users/henry/a/sdkman"</span> &amp;&amp; curl -s <span class="string">"https://get.sdkman.io"</span> | bash</div><div class="line">sdk install springboot 1.5.6.RELEASE</div><div class="line">spring version</div><div class="line">sdk use springboot 1.5.6.RELEASE</div><div class="line"><span class="comment"># https://github.com/spring-cloud/spring-cloud-cli</span></div><div class="line">spring install org.springframework.cloud:spring-cloud-cli:1.3.4.RELEASE</div><div class="line"><span class="comment"># 检验一下，启动一个 eureka,还没开始码，已经有了现成的一套eureka，configserver，h2，kafka了</span></div><div class="line">spring cloud eureka</div></pre></td></tr></table></figure>
<h4 id="先来个hello-groovy-的sb"><a href="#先来个hello-groovy-的sb" class="headerlink" title="先来个hello groovy 的sb"></a>先来个hello groovy 的sb</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app.groovy</span></div><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebApplication</span> &#123;</span></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</div><div class="line">    String home() &#123;</div><div class="line">        <span class="string">"Hello, Groovy in Spring!"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## To pass command line arguments to the application, </span></div><div class="line"><span class="comment">## you need to use a -- to separate them from the “spring” command arguments, e.g.</span></div><div class="line">spring run app.groovy -- --server.port=8081</div></pre></td></tr></table></figure>
<h4 id="再来个-hello-spring-cloud"><a href="#再来个-hello-spring-cloud" class="headerlink" title="再来个 hello spring-cloud"></a>再来个 hello spring-cloud</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// eureka.groovy</span></div><div class="line"><span class="meta">@EnableEurekaServer</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Eureka</span> &#123;</span>&#125;</div></pre></td></tr></table></figure>
<p>运行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">spring run eureka.groovy -- --server.port=8081</div></pre></td></tr></table></figure></p>
<h4 id="继续玩"><a href="#继续玩" class="headerlink" title="继续玩?"></a>继续玩?</h4><p><a href="https://github.com/spring-cloud-samples/scripts/tree/master/demo" target="_blank" rel="external">来这里玩一遍</a><br><a href="https://github.com/spring-projects/spring-boot/tree/v1.4.7.RELEASE/spring-boot-cli/samples" target="_blank" rel="external">还有这里</a></p>
<p>玩了一下，需要了解<a href="http://groovy-lang.org/learn.html" target="_blank" rel="external">groovy?</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201708/spring-boot/spring-boot酸爽debug之路/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201708/spring-boot/spring-boot酸爽debug之路/" itemprop="url">spring-boot酸爽debug之路</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-25T14:47:59+08:00">
                2017-08-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="方式一-devtools"><a href="#方式一-devtools" class="headerlink" title="方式一:devtools"></a>方式一:devtools</h2><p><a href="https://docs.spring.io/spring-boot/docs/1.4.7.RELEASE/reference/htmlsingle/#using-boot-devtools" target="_blank" rel="external">https://docs.spring.io/spring-boot/docs/1.4.7.RELEASE/reference/htmlsingle/#using-boot-devtools</a><br>pom加上依赖即可，记得要在profile里面切换，否则浪费了正式环境的硬件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--</span></div><div class="line"><span class="comment">        &lt;dependencies&gt;</span></div><div class="line"><span class="comment">            &lt;dependency&gt;</span></div><div class="line"><span class="comment">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div><div class="line"><span class="comment">                &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span></div><div class="line"><span class="comment">                &lt;optional&gt;true&lt;/optional&gt;</span></div><div class="line"><span class="comment">            &lt;/dependency&gt;</span></div><div class="line"><span class="comment">        &lt;/dependencies&gt;</span></div><div class="line"><span class="comment">        --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- log configuration --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">logback.loglevel</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">logback.loglevel</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- default Spring profiles --&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springloaded<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- log configuration --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">logback.loglevel</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">logback.loglevel</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- default Spring profiles --&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="如果是gradlew-还要麻烦一点"><a href="#如果是gradlew-还要麻烦一点" class="headerlink" title="如果是gradlew 还要麻烦一点"></a>如果是gradlew 还要麻烦一点</h2><p>80.4.2 Configuring Spring Loaded for use with Gradle and IntelliJ IDEA</p>
<p>You need to jump through a few hoops if you want to use Spring Loaded in combination with Gradle and IntelliJ IDEA. By default, IntelliJ IDEA will compile classes into a different location than Gradle, causing Spring Loaded monitoring to fail.</p>
<p>To configure IntelliJ IDEA correctly you can use the idea Gradle plugin:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123; jcenter() &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath <span class="string">"org.springframework.boot:spring-boot-gradle-plugin:1.4.7.RELEASE"</span></div><div class="line">        classpath <span class="string">'org.springframework:springloaded:1.2.6.RELEASE'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">apply <span class="string">plugin:</span> <span class="string">'idea'</span></div><div class="line"></div><div class="line">idea &#123;</div><div class="line">    module &#123;</div><div class="line">        inheritOutputDirs = <span class="literal">false</span></div><div class="line">        outputDir = file(<span class="string">"$buildDir/classes/main/"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ...</span></div></pre></td></tr></table></figure>
<h2 id="方式二-spring-loaded"><a href="#方式二-spring-loaded" class="headerlink" title="方式二: spring-loaded"></a>方式二: spring-loaded</h2><p>升级版的 devtools  加减方法都不用重启。<br>不过像Controller这种，需要SpringMVC装载的就不行了，新加一个接口就404了，还是要重启</p>
<p><a href="https://docs.spring.io/spring-boot/docs/1.4.7.RELEASE/reference/htmlsingle/#howto-reload-java-classes-without-restarting" target="_blank" rel="external">官方文档</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">80.3 Fast application restarts</div><div class="line">The spring-boot-devtools module includes support for automatic application restarts. Whilst not as fast a technologies such as JRebel or Spring Loaded it’s usually significantly faster than a “cold start”. You should probably give it a try before investigating some of the more complex reload options discussed below.</div><div class="line"></div><div class="line">For more details see the Chapter 20, Developer tools section.</div><div class="line"></div><div class="line">80.4 Reload Java classes without restarting the container</div><div class="line">Modern IDEs (Eclipse, IDEA, etc.) all support hot swapping of bytecode, so if you make a change that doesn’t affect class or method signatures it should reload cleanly with no side effects.</div><div class="line"></div><div class="line">Spring Loaded goes a little further in that it can reload class definitions with changes in the method signatures. With some customization it can force an ApplicationContext to refresh itself (but there is no general mechanism to ensure that would be safe for a running application anyway, so it would only ever be a development time trick probably).</div></pre></td></tr></table></figure>
<h2 id="方式三-JRebel"><a href="#方式三-JRebel" class="headerlink" title="方式三: JRebel"></a>方式三: <a href="http://zeroturnaround.com/software/jrebel/" target="_blank" rel="external">JRebel</a></h2><p>有空再研究一下，目前推荐用spring-loaded</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>注意，在IDEA需要在Debug模式下才会启用spring-loaded</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201708/git/git-subtree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201708/git/git-subtree/" itemprop="url">git 收集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-25T14:15:20+08:00">
                2017-08-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="subtree"><a href="#subtree" class="headerlink" title="subtree"></a>subtree</h4><p><a href="http://www.jianshu.com/p/3096069e9b72" target="_blank" rel="external">http://www.jianshu.com/p/3096069e9b72</a></p>
<h4 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h4><p><a href="http://yongpoliu.com/reorganize-git-local-commits/" target="_blank" rel="external">http://yongpoliu.com/reorganize-git-local-commits/</a></p>
<h4 id="monkey-git"><a href="#monkey-git" class="headerlink" title="monkey git"></a>monkey git</h4><p><a href="https://backlogtool.com/git-tutorial/cn/" target="_blank" rel="external">https://backlogtool.com/git-tutorial/cn/</a></p>
<h4 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h4><p><a href="http://blog.jobbole.com/81196/" target="_blank" rel="external">http://blog.jobbole.com/81196/</a><br><a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="external">http://nvie.com/posts/a-successful-git-branching-model/</a></p>
<h4 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h4><p><a href="http://learngitbranching.js.org/?demo" target="_blank" rel="external">http://learngitbranching.js.org/?demo</a></p>
<h4 id="gitflow-video"><a href="#gitflow-video" class="headerlink" title="gitflow video"></a>gitflow video</h4><p><a href="https://buildamodule.com/video/change-management-and-version-control-deploying-releases-features-and-fixes-with-git-how-to-use-a-scalable-git-branching-model-called-gitflow#viewing" target="_blank" rel="external">https://buildamodule.com/video/change-management-and-version-control-deploying-releases-features-and-fixes-with-git-how-to-use-a-scalable-git-branching-model-called-gitflow#viewing</a></p>
<h4 id="gitlfow-plugin"><a href="#gitlfow-plugin" class="headerlink" title="gitlfow plugin"></a>gitlfow plugin</h4><p><a href="https://github.com/nvie/gitflow/wiki/Installation" target="_blank" rel="external">https://github.com/nvie/gitflow/wiki/Installation</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201708/nginx/nginx正向代理-带密码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201708/nginx/nginx正向代理-带密码/" itemprop="url">nginx正向代理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-24T10:23:52+08:00">
                2017-08-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>适合临时用一下来调试线上环境，反正nginx都有的情况下，何必装个squid<br>注意，不能同时支持 https和http<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># forward-proxy.conf</span></div><div class="line">server&#123;</div><div class="line">     <span class="attribute">listen</span> <span class="number">8765</span>;</div><div class="line">     <span class="attribute">client_body_timeout</span> <span class="number">60000</span>;</div><div class="line">     <span class="attribute">client_max_body_size</span> <span class="number">1024m</span>;</div><div class="line">     <span class="attribute">send_timeout</span>       <span class="number">60000</span>;</div><div class="line">     <span class="attribute">client_header_buffer_size</span> <span class="number">16k</span>;</div><div class="line">     <span class="attribute">large_client_header_buffers</span> <span class="number">4</span> <span class="number">64k</span>;</div><div class="line"></div><div class="line">     <span class="attribute">proxy_headers_hash_bucket_size</span> <span class="number">1024</span>;</div><div class="line">     <span class="attribute">proxy_headers_hash_max_size</span> <span class="number">4096</span>;</div><div class="line">     <span class="attribute">proxy_read_timeout</span> <span class="number">60000</span>;</div><div class="line">     <span class="attribute">proxy_send_timeout</span> <span class="number">60000</span>;</div><div class="line"></div><div class="line">     <span class="attribute">location</span> / &#123;</div><div class="line">         <span class="comment">#auth_basic "Please enter your password:";</span></div><div class="line">         <span class="comment">#auth_basic_user_file conf.d/conf.d/forward-proxy.passwd;</span></div><div class="line">         <span class="attribute">resolver</span> <span class="number">8.8.8.8</span>;</div><div class="line">         <span class="attribute">proxy_pass</span> <span class="variable">$schema</span>://<span class="variable">$http_host</span><span class="variable">$request_uri</span>;</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 实测发现加上auth_basic后用浏览器的代理设置，每次都需要弹出问密码，看来还是用squid</span></div><div class="line"><span class="built_in">printf</span> <span class="string">"userD:<span class="variable">$(openssl passwd -crypt 123456)</span>\n"</span> &gt;&gt;conf.d/forward-proxy.passwd</div><div class="line">cat conf/forward-proxy.passwd</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://imlh.cn/201708/spring-boot/RestTemplate配置泛型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="木鱼">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/static/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木鱼's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/201708/spring-boot/RestTemplate配置泛型/" itemprop="url">RestTemplate配置泛型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-23T14:54:00+08:00">
                2017-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="用Spring的东西呢，就得一套套标准的来。问题是别人的系统不标准呢？"><a href="#用Spring的东西呢，就得一套套标准的来。问题是别人的系统不标准呢？" class="headerlink" title="用Spring的东西呢，就得一套套标准的来。问题是别人的系统不标准呢？"></a>用Spring的东西呢，就得一套套标准的来。问题是别人的系统不标准呢？</h3><h4 id="例如，遇到-接口返回的数据是这样的"><a href="#例如，遇到-接口返回的数据是这样的" class="headerlink" title="例如，遇到 接口返回的数据是这样的"></a>例如，遇到 接口返回的数据是这样的</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"code"</span>:<span class="number">1000</span>,<span class="attr">"msg"</span>:<span class="string">"U R Fncked"</span>&#125;</div></pre></td></tr></table></figure>
<p>Header返回的ContentType却为 text/plain,这种接口，手动解析当然没问题。<br>一定要用RestTemplate怎么破？</p>
<h4 id="再坑一点，请求Header制定了-Accept为-application-json"><a href="#再坑一点，请求Header制定了-Accept为-application-json" class="headerlink" title="再坑一点，请求Header制定了 Accept为 application/json"></a>再坑一点，请求Header制定了 Accept为 application/json</h4><p>只不过长这样了,字符串确实是标准的JSON啊：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">"&#123;\"code\":1000,\"msg\":\"U R Fncked Again\"&#125;"</span></div></pre></td></tr></table></figure></p>
<h4 id="所以就特殊情况特殊处理了"><a href="#所以就特殊情况特殊处理了" class="headerlink" title="所以就特殊情况特殊处理了"></a>所以就特殊情况特殊处理了</h4><ul>
<li>继承一个MappingJackson2HttpMessageConverter 让他能处理 TEXT_PLAIN</li>
<li>RestTemplate加上拦截器，把Accept去掉（默认为 application/json)</li>
</ul>
<h3 id="泛型-才是本篇的主题，见代码（以上全是以毒攻毒地处理了一下坑"><a href="#泛型-才是本篇的主题，见代码（以上全是以毒攻毒地处理了一下坑" class="headerlink" title="泛型 才是本篇的主题，见代码（以上全是以毒攻毒地处理了一下坑)"></a>泛型 才是本篇的主题，见代码（以上全是以毒攻毒地处理了一下坑)</h3><p>值得一提的是这个东西  ParameterizedTypeReference<br>一定要new出来，有点别扭，不知能否用反射加泛型构造出来？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Data</span></div><div class="line"><span class="meta">@AllArgsConstructor</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JkmApiException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</div><div class="line">    <span class="keyword">private</span> String msg;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Data</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JkmApiResponse</span>&lt;<span class="title">D</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</div><div class="line">    <span class="keyword">private</span> String msg;</div><div class="line">    <span class="keyword">private</span> D data;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JkmApiService</span></span>&#123;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TPMappingJackson2HttpMessageConverter</span> <span class="keyword">extends</span> <span class="title">MappingJackson2HttpMessageConverter</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TPMappingJackson2HttpMessageConverter</span><span class="params">()</span> </span>&#123;</div><div class="line">            List&lt;MediaType&gt; mediaTypes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">            mediaTypes.add(MediaType.TEXT_PLAIN);</div><div class="line">            setSupportedMediaTypes(mediaTypes);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">JkmApiHttpRequestInterceptor</span> <span class="keyword">implements</span> <span class="title">ClientHttpRequestInterceptor</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> ClientHttpResponse <span class="title">intercept</span><span class="params">(HttpRequest request, <span class="keyword">byte</span>[] body, ClientHttpRequestExecution execution)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            HttpHeaders headers = request.getHeaders();</div><div class="line">            headers.setAccept(Collections.emptyList());</div><div class="line">            headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);</div><div class="line">            <span class="keyword">return</span> execution.execute(request, body);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JkmApiService</span><span class="params">()</span> </span>&#123;</div><div class="line">        SimpleClientHttpRequestFactory httpClientFactory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</div><div class="line">        Proxy proxy = <span class="keyword">new</span> Proxy(Proxy.Type.HTTP, <span class="keyword">new</span> InetSocketAddress(<span class="string">"a.b.c"</span>, <span class="number">8765</span>));</div><div class="line">        <span class="comment">// httpClientFactory.setProxy(proxy);  //@TODO 解开这个用来突破IP白名单限制,用于调试正式环境</span></div><div class="line">        <span class="keyword">this</span>.restTemplate.setRequestFactory(httpClientFactory);</div><div class="line">        <span class="keyword">this</span>.restTemplate.setInterceptors(Collections.singletonList(<span class="keyword">new</span> JkmApiHttpRequestInterceptor()));</div><div class="line">        <span class="keyword">this</span>.restTemplate.getMessageConverters().add(<span class="keyword">new</span> TPMappingJackson2HttpMessageConverter());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 统一异常处理流程</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> entity</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;D&gt;</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     * <span class="doctag">@throws</span> JkmApiException</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> &lt;T extends JkmApiResponse&lt;D&gt;, D&gt; <span class="function">D <span class="title">getData</span><span class="params">(ResponseEntity&lt;T&gt; entity)</span> <span class="keyword">throws</span> JkmApiException </span>&#123;</div><div class="line">        T body = entity.getBody();</div><div class="line">        <span class="keyword">if</span> (entity.getStatusCode() != HttpStatus.OK) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> JkmApiException(-<span class="number">1</span>, <span class="string">"请求失败"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (body.getCode() != <span class="number">2000</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> JkmApiException(body.getCode(), body.getMsg());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> body.getData();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 根据 data的类类型获取数据(post)</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> formData</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> typeReference</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> urlParams</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;D&gt;</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     * <span class="doctag">@throws</span> JkmApiException</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> &lt;D&gt; <span class="function">D <span class="title">postForData</span><span class="params">(String url, Map&lt;String, String&gt; formData, ParameterizedTypeReference&lt;JkmApiResponse&lt;D&gt;&gt; typeReference, Object... urlParams)</span> <span class="keyword">throws</span> JkmApiException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!url.startsWith(host)) &#123;</div><div class="line">            url = host + url;</div><div class="line">        &#125;</div><div class="line">        MultiValueMap&lt;String, String&gt; param = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</div><div class="line">        <span class="keyword">if</span> (formData != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : formData.entrySet()) &#123;</div><div class="line">                param.add(e.getKey(), e.getValue());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; formEntity = <span class="keyword">new</span> HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt;(param, <span class="keyword">null</span>);</div><div class="line">        ResponseEntity&lt;JkmApiResponse&lt;D&gt;&gt; rsp = <span class="keyword">this</span>.restTemplate.exchange(</div><div class="line">                url, HttpMethod.POST, formEntity, typeReference, urlParams);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getData(rsp);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 获取SSO系统时间戳</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getTimeStamp</span><span class="params">()</span> <span class="keyword">throws</span> JkmApiException </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.postForData(<span class="string">"/getTimeStamp.do"</span>, <span class="keyword">null</span>, <span class="keyword">new</span> ParameterizedTypeReference&lt;JkmApiResponse&lt;Long&gt;&gt;() &#123;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">     <span class="comment">/**</span></div><div class="line"><span class="comment">     * 校验用户访问令牌</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> accessToken</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> <span class="doctag">@TODO</span> 定义成类</span></div><div class="line"><span class="comment">     * <span class="doctag">@throws</span> JkmApiException</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">validToken</span><span class="params">(String accessToken, String data)</span> <span class="keyword">throws</span> JkmApiException </span>&#123;</div><div class="line">        Map&lt;String, String&gt; param = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</div><div class="line">        param.put(<span class="string">"accessToken"</span>, accessToken);</div><div class="line">        param.put(<span class="string">"data"</span>, data);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.postForData(<span class="string">"/insvr/sso/token/user.do"</span>, param, <span class="keyword">new</span> ParameterizedTypeReference&lt;JkmApiResponse&lt;Map&lt;String, Object&gt;&gt;&gt;() &#123;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 根据用户的令牌token 获取用户的基本信息</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> accessToken 用户令牌</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> 返回用户的基本信息</span></div><div class="line"><span class="comment">     * <span class="doctag">@throws</span> JkmApiException</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">getUserInfos</span><span class="params">(String accessToken)</span> <span class="keyword">throws</span> JkmApiException </span>&#123;</div><div class="line">        Map&lt;String, String&gt; param = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</div><div class="line">        param.put(<span class="string">"accessToken"</span>, accessToken);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.postForData(<span class="string">"/insvr/sso/token/user.do"</span>, param, <span class="keyword">new</span> ParameterizedTypeReference&lt;JkmApiResponse&lt;UserInfo&gt;&gt;() &#123;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">.....</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/static/img/avatar.jpg"
               alt="木鱼" />
          <p class="site-author-name" itemprop="name">木鱼</p>
           
              <p class="site-description motion-element" itemprop="description">生命有限，能量守恒<br>码农生涯，重在过程</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">木鱼</span>
</div>


<div class="powered-by">
  Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
</div>
<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Gemini
  </a>
</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
